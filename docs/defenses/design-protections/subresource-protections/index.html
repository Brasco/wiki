<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Subresources Protections"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Subresource Protections"><meta property="og:description" content="Subresources Protections"><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/defenses/design-protections/subresource-protections/"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-16T08:55:34-07:00"><title>Subresource Protections | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.092646ee0a13bc3d434088e3ef209623b91ad8714e3f5b61c7d3d1a096669ae7.css integrity="sha256-CSZG7goTvD1DQIjj7yCWI7ka2HFOP1thx9PRoJZmmuc="><script defer src=/en.search.min.1cb2c6fa03450539833df3ef7c98c2ab9ad829929ad28c277d018f26d9127765.js integrity="sha256-HLLG+gNFBTmDPfPvfJjCq5rYKZKa0ownfQGPJtkSd2U="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/ class=active>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Subresource Protections</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#token-based-protections>Token Based Protections</a></li><li><a href=#user-consent>User Consent</a></li></ul></nav></aside></header><article class=markdown><h1>Subresource Protections</h1><h5>October 1, 2020</h5><div>Category
<a href=/category/defense/>Defense</a></div><p><p>The fundamental idea behind designing protections for subresources is that subresources cannot be targeted by XS-Leaks if the attacker cannot cause them to return any user data. If implemented correctly, this can be a very strong defense though it is likely to be tough to implement and could negatively impact the user experience.</p><blockquote class="book-hint warning">It can be very effective to deploy this on any specific resources that are known to be especially senstive to XS-Leaks. But, due to the challenges of deploying this protection universally, applications are encouraged to deploy <a href=https://xsleaks.com/docs/defenses/>opt-in web platform security features</a> as the default approach.</blockquote><h2 id=token-based-protections>Token Based Protections
<a class=anchor href=#token-based-protections>#</a></h2><p>A strong protection for subresources can be achieved by including a user specific token in every request. This protects against most XS-Leak techniques if implemented correctly. The idea is that in order to verify a request for a resource as being legitimate, a token must be included. This token must be provided to the client in some way that an attacker would not be able to cause it to be included in their own requests.</p><blockquote class="book-hint info"><p>Suppose there is a search bar on an application.</p><ol><li>When the user loads the main page, the server includes a secure token somewhere in the body of the page.</li><li>When the user searches for something, a request is made to <code>/search?query=&lt;QUERY>&token=&lt;SECURE_TOKEN></code>.</li><li>The backend verifies that the provided token is valid for the current user.</li><li>If it is not valid, the request is rejected.</li></ol><p>In this scenario, there is no way for an attacker to trigger any requests to the endpoint because they cannot obtain a valid token for a given user. Note that this relies on it not being possible for an attacker to obtain or forge a token for other users. If they can do so, this is not effective.</p></blockquote><p>This style of protection can be applied to:</p><ul><li>Authenticated subresources such as API endpoints or regular authenticated URLs. While tokens can be used in this case, security mitigations like <a href=https://xsleaks.com/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a> may be easier to deploy at scale.</li><li>Unauthenticated subresources such as images can use this protection to prevent some types of <a href=https://xsleaks.com/docs/attacks/cache-probing/>Cache Probing Attacks</a>. While this does work, see <a href=https://xsleaks.com/docs/defenses/design-protections/cache-protections/>Cache Protections</a> for other strategies to defend against cache probing attacks.</li></ul><blockquote class="book-hint warning">Implementing this might break the ability for users to save or share links (eg bookmarks).</blockquote><h2 id=user-consent>User Consent
<a class=anchor href=#user-consent>#</a></h2><p>Another strong defense is to require user interaction before returning any sensitive data. This ensures that sensitive endpoints cannot be included via <code>script</code> or <code>img</code> tags. For example, Facebook requires user confirmation before viewing search results or private messages. Since attackers cannot simulate this user interaction, they will be unable to leak the contents of the search results.</p><p>This can be a very useful way of protecting especially sensitive endpoints though note once again that this is likely to be time consuming to implement.</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/22d1cab2f55b5cb78c36f9b37d70b59a1eb4604a title="Last modified by David Dworken | October 16, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: October 16, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/defenses/design-protections/subresource-protections.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#token-based-protections>Token Based Protections</a></li><li><a href=#user-consent>User Consent</a></li></ul></nav></aside></main></body></html>