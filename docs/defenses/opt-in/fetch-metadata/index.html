<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Fetch Metadata Headers are sent by browsers in every request or navigation made by a page. These Headers provide context on how every request/navigation was initiated so that applications are able to make more informed decisions on how to respond to them. This allows servers to behave differently when they detect potential attacks (i.e. unexpected cross-origin requests)1. This mechanism can be very effective against cross-origin attacks like XSSI, XS-Leaks, Clickjacking, and CSRF."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Fetch Metadata"><meta property="og:description" content="Fetch Metadata Headers are sent by browsers in every request or navigation made by a page. These Headers provide context on how every request/navigation was initiated so that applications are able to make more informed decisions on how to respond to them. This allows servers to behave differently when they detect potential attacks (i.e. unexpected cross-origin requests)1. This mechanism can be very effective against cross-origin attacks like XSSI, XS-Leaks, Clickjacking, and CSRF."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/defenses/opt-in/fetch-metadata/"><meta property="article:published_time" content="2020-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-25T20:00:16+01:00"><title>Fetch Metadata | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.3fdda1dce1e2459a1b1fc70c3e00001cd6e4d2f1f32f38ddef6e12ca41e9cef6.css integrity="sha256-P92h3OHiRZobH8cMPgAAHNbk0vHzLzjd724SykHpzvY="><script defer src=/en.search.min.55bbe51b7c566d76276792047f4ea0e56d93dbbc0aefdca33c3791dc096ab941.js integrity="sha256-VbvlG3xWbXYnZ5IEf06g5W2T27wK79yjPDeR3AlquUE="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/attacks/>Attacks</a><ul><li><a href=/docs/attacks/experiments/>Experiments</a><ul><li><a href=/docs/attacks/experiments/scroll-to-text-fragment/>Scroll to Text Fragment</a></li></ul></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li><li><a href=/docs/attacks/timing-attacks/>Timing Attacks</a><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li></ul></li><li><a href=/docs/attacks/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/corp/>CORP Leaks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><span>Application Design</span><ul><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><span>Browser Default</span><ul><li><a href=/docs/defenses/browser-intrinsic/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/browser-intrinsic/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li><li><span>Opt-In</span><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/ class=active>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Fetch Metadata</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#fetch-metadata--cache-probing-attacks>Fetch Metadata & Cache Probing Attacks</a></li><li><a href=#considerations>Considerations</a></li><li><a href=#deployment>Deployment</a></li><li><a href=#xs-leaks-mitigation-overview>XS-Leaks Mitigation Overview</a><ul><li><a href=#table-caption>Table Caption</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1>Fetch Metadata</h1><h5>July 21, 2020</h5><div>Category
<a href=/category/defenses/>defenses</a></div><p><p>Fetch Metadata Headers are sent by browsers in every request or navigation made by a page. These Headers provide context on how every request/navigation was initiated so that applications are able to make more informed decisions on how to respond to them. This allows servers to behave differently when they detect potential attacks (i.e. unexpected cross-origin requests)<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. This mechanism can be very effective against cross-origin attacks like XSSI, XS-Leaks, Clickjacking, and CSRF.</p><p>In the scenario of XS-Leaks, servers have the ability to know when a request was made cross-origin (e.g attacker origin) and decide to answer with a response analogous to the user session. This response has no utility to the attacker since it does not carry any information or state about the user. This behavior is similar to <a href=https://TODO>SameSite Cookies</a>, but it&rsquo;s enforced by the server.</p><h2 id=fetch-metadata--cache-probing-attacks>Fetch Metadata & Cache Probing Attacks
<a class=anchor href=#fetch-metadata--cache-probing-attacks>#</a></h2><p>Another interesting application of Fetch Metadata is its combination with the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary>Vary</a> Response Header, used to <strong>segregate</strong> served cached resources by groups of origins. The <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary>Vary</a> Header when set with <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-Fetch-Site><code>Sec-Fetch-Site</code></a> will store and serve different cached entries based on the origin who originally performed the request. With this Header, an attacker which tries to <a href=https://TODO>probe a cached resource</a> of a different origin won&rsquo;t be able to interfere with cached entries created from same-origin/same-site.</p><p>The behavior enforced by this Header does not require major changes in the server codebase. This protection can achieve a similar protection enforced by a <a href=https://TODO>partitioned cache</a>.</p><h2 id=considerations>Considerations
<a class=anchor href=#considerations>#</a></h2><p>Fetch Metadata Headers are an <strong>in-depth Defense Mechanism</strong> and should <strong>not be seen as a replacement</strong> for mechanisms such as <a href=https://xsleaks.com/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a>, <a href=https://xsleaks.com/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a> or <a href=https://xsleaks.com/docs/defenses/opt-in/xfo/>Framing Protections</a>. Even though Fetch Metadata Headers share some capabilities with these mechanisms (i.e act differently upon cross-site requests), <strong>they do not provide a safe default</strong>.
Its success is dependent on the application coverage and deployment correctness.</p><h2 id=deployment>Deployment
<a class=anchor href=#deployment>#</a></h2><p>Check out this <a href=https://web.dev/fetch-metadata/>web.dev</a> article to learn more about the advantages of this protection and how to deploy it.</p><h2 id=xs-leaks-mitigation-overview>XS-Leaks Mitigation Overview
<a class=anchor href=#xs-leaks-mitigation-overview>#</a></h2><table><thead><tr><th style=text-align:center>XS-Leak</th><th style=text-align:center>Full Mitigation</th></tr></thead><tbody><tr><td style=text-align:center><a href=https://xsleaks.com/docs/attacks/frame-counting/>Frame Counting</a></td><td style=text-align:center>✔️</td></tr><tr><td style=text-align:center><a href=https://xsleaks.com/docs/attacks/navigations/>Navigations</a></td><td style=text-align:center>✔️</td></tr><tr><td style=text-align:center><a href=https://xsleaks.com/docs/attacks/id-attribute/>ID Leaks</a></td><td style=text-align:center>✔️</td></tr></tbody></table><h3 id=table-caption>Table Caption
<a class=anchor href=#table-caption>#</a></h3><ul><li><strong>Full Mitigation</strong> - Fully mitigates some XS-Leaks if correctly implemented in all application endpoints. <em>See limitations in <a href=https://xsleaks.com/docs/defenses/opt-in/fetch-metadata/#considerations>Considerations</a></em></li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Protect your resources from web attacks with Fetch Metadata, <a href=https://web.dev/fetch-metadata/>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/b4b14d7f75d355653e422eca45d0b08a0a766f57 title="Last modified by Manuel Sousa | September 25, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: September 25, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/defenses/opt-in/fetch-metadata.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#fetch-metadata--cache-probing-attacks>Fetch Metadata & Cache Probing Attacks</a></li><li><a href=#considerations>Considerations</a></li><li><a href=#deployment>Deployment</a></li><li><a href=#xs-leaks-mitigation-overview>XS-Leaks Mitigation Overview</a><ul><li><a href=#table-caption>Table Caption</a></li></ul></li></ul></nav></aside></main></body></html>