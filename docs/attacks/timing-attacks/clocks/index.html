<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We can distinguish two types of clocks - Explicit and Implicit. Explicit clocks are the ones developers use to get direct timing measurements and such mechanisms are offered explicitly by the browser. Implicit clocks on the other hand, misuse particular web features to create unintended clocks which offer a relative timing.
Explicit Clocks #  performance.now API #  The performance.now() API allows developers to get high-resolution timing measurements.
performance.now() API got its accuracy reduced from a range of nanoseconds to a microsecond precision in all modern browsers, to mitigate some XS-Leaks 1 2 3."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Clocks"><meta property="og:description" content="We can distinguish two types of clocks - Explicit and Implicit. Explicit clocks are the ones developers use to get direct timing measurements and such mechanisms are offered explicitly by the browser. Implicit clocks on the other hand, misuse particular web features to create unintended clocks which offer a relative timing.
Explicit Clocks #  performance.now API #  The performance.now() API allows developers to get high-resolution timing measurements.
performance.now() API got its accuracy reduced from a range of nanoseconds to a microsecond precision in all modern browsers, to mitigate some XS-Leaks 1 2 3."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/attacks/timing-attacks/clocks/"><meta property="article:published_time" content="2020-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-07T19:20:56+02:00"><title>Clocks | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.3fdda1dce1e2459a1b1fc70c3e00001cd6e4d2f1f32f38ddef6e12ca41e9cef6.css integrity="sha256-P92h3OHiRZobH8cMPgAAHNbk0vHzLzjd724SykHpzvY="><script defer src=/en.search.min.55bbe51b7c566d76276792047f4ea0e56d93dbbc0aefdca33c3791dc096ab941.js integrity="sha256-VbvlG3xWbXYnZ5IEf06g5W2T27wK79yjPDeR3AlquUE="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/attacks/>Attacks</a><ul><li><a href=/docs/attacks/experiments/>Experiments</a><ul><li><a href=/docs/attacks/experiments/scroll-to-text-fragment/>Scroll to Text Fragment</a></li></ul></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li><li><a href=/docs/attacks/timing-attacks/>Timing Attacks</a><ul><li><a href=/docs/attacks/timing-attacks/clocks/ class=active>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li></ul></li><li><a href=/docs/attacks/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/corp/>CORP Leaks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><span>Application Design</span><ul><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><span>Browser Default</span><ul><li><a href=/docs/defenses/browser-intrinsic/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/browser-intrinsic/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li><li><span>Opt-In</span><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Clocks</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#explicit-clocks>Explicit Clocks</a><ul><li><a href=#performancenow-api>performance.now API</a></li><li><a href=#date-api>Date API</a></li></ul></li><li><a href=#implicit-clocks>Implicit Clocks</a><ul><li><a href=#sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers</a></li><li><a href=#other-clocks>Other Clocks</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1>Clocks</h1><h5>July 21, 2020</h5><div>Attacks
<a href=/attacks/dom-property/>dom property</a></div><div>Category
<a href=/category/attacks/>attacks</a></div><div>Defenses
<a href=/defenses/same-site-cookies/>same-site cookies</a>,
<a href=/defenses/sec-fetch-metadata/>sec-fetch metadata</a></div><p><p>We can distinguish two types of clocks - Explicit and Implicit. Explicit clocks are the ones developers use to get direct timing measurements and such mechanisms are offered <strong>explicitly</strong> by the browser. Implicit clocks on the other hand, misuse particular web features to create unintended clocks which offer a relative timing.</p><h2 id=explicit-clocks>Explicit Clocks
<a class=anchor href=#explicit-clocks>#</a></h2><h3 id=performancenow-api>performance.now API
<a class=anchor href=#performancenow-api>#</a></h3><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/now>performance.now()</a> API allows developers to get high-resolution timing measurements.</p><blockquote class="book-hint info"><p><code>performance.now()</code> API got its accuracy reduced from a range of nanoseconds to a
microsecond precision in all modern browsers, to mitigate <a href=httos://TODO>some</a> XS-Leaks <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Reduce resolution of performance.now (Webkit). <a href="https://bugs.webkit.org/show_bug.cgi?id=146531">link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Reduce precision of performance.now() to 20us (Gecko). <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1427870">link</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Reduce resolution of performance.now to prevent timing attacks (Blink). <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=506723">link</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></blockquote><blockquote class="book-hint info">Since Firefox 79, this API can be used with <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/79>full resolution</a> in documents which do not share a browsing context group with cross-origin documents. This will require an application interested in the API to explicitly opt-in to <a href=https://TODO>COOP</a> and <a href=https://TODO>COEP</a>.</blockquote><h3 id=date-api>Date API
<a class=anchor href=#date-api>#</a></h3><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date>Date</a> API is the oldest API present in browsers to obtain timing measurements. It allows developers to get dates, and get Unix timestamps with <code>Date.now()</code>. These measurements are much less precise compared to <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/now>performance.now()</a>. Before the introduction of newer APIs attacks used to leverage this instead <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><h2 id=implicit-clocks>Implicit Clocks
<a class=anchor href=#implicit-clocks>#</a></h2><h3 id=sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers
<a class=anchor href=#sharedarraybuffer-and-web-workers>#</a></h3><p>With the introduction of <code>Web Workers</code>, new mechanisms to exchange data between threads were created <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. <code>SharedArrayBuffer</code>, one of those mechanisms, provides memory sharing between the main thread and a worker thread. Attackers can create an implicit clock with a <code>Worker</code> and use a <code>SharedArrayBuffer</code> as the tunnel to consult this clock. Since the <code>Worker</code> has its own thread, the clock consists of a simple infinite loop iterating over a structure shared with the main thread. This clock does not provide a time measurement, but rather a measurement on how fast the worker thread increments.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// -------- Main Thread clock creation -------- 
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SharedArrayBuffer</span>(<span style=color:#ae81ff>16</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>counter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Worker</span>(<span style=color:#e6db74>&#34;counter.js&#34;</span>);
<span style=color:#a6e22e>counter</span>.<span style=color:#a6e22e>postMessage</span>([<span style=color:#a6e22e>buffer</span>],[<span style=color:#a6e22e>buffer</span>]);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>arr</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UintArray</span>(<span style=color:#a6e22e>buffer</span>);
<span style=color:#a6e22e>relative_time</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>arr</span>[<span style=color:#ae81ff>0</span>];

<span style=color:#75715e>// -------- Web Worker counter.js -------- 
</span><span style=color:#75715e></span><span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>onmessage</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>){
  <span style=color:#66d9ef>var</span>[<span style=color:#a6e22e>buffer</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>data</span> ;
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>arr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newUintArray</span>(<span style=color:#a6e22e>buffer</span>);
  <span style=color:#66d9ef>while</span>(<span style=color:#ae81ff>1</span>){
    <span style=color:#a6e22e>arr</span>[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>++</span>;
  }
}

</code></pre></div><blockquote class="book-hint info"><code>SharedArrayBuffer</code> was removed from browsers with the publication of <a href=https://spectreattack.com/>Spectre</a>. It was reintroduced later in 2020 requiring documents to be in a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer>secure context</a> to make use of the API. This requirement prevents <code>SharedArrayBuffer</code> from being used as an implicit clock.</blockquote><h3 id=other-clocks>Other Clocks
<a class=anchor href=#other-clocks>#</a></h3><p>There are a considerable amount of APIs attackers can abuse to create implicit clocks: <a href=https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API>Broadcast Channel API</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel>Message Channel API</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame>requestAnimationFrame</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout>setTimeout</a>, CSS animations and others <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Exposing Private Information by Timing Web Applications, <a href=http://crypto.stanford.edu/~dabo/papers/webtiming.pdf>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Shared memory: Side-channel information leaks, <a href=https://github.com/tc39/ecmascript_sharedmem/blob/master/issues/TimingAttack.md>link</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Fantastic Timers and Where to Find Them: High-Resolution Microarchitectural Attacks in JavaScript, <a href=https://gruss.cc/files/fantastictimers.pdf>link</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>Trusted Browsers for Uncertain Times, <a href=https://www.usenix.org/system/files/conference/usenixsecurity16/sec16_paper_kohlbrenner.pdf>link</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/2ddca901c23ec34e9674bebec50434dc04cb45e2 title="Last modified by terjanq | September 7, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: September 7, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/timing-attacks/clocks.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#explicit-clocks>Explicit Clocks</a><ul><li><a href=#performancenow-api>performance.now API</a></li><li><a href=#date-api>Date API</a></li></ul></li><li><a href=#implicit-clocks>Implicit Clocks</a><ul><li><a href=#sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers</a></li><li><a href=#other-clocks>Other Clocks</a></li></ul></li></ul></nav></aside></main></body></html>