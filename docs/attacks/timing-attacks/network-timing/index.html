<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Network Timing side-channels have been present on the web since its beginning 1 2. These attacks have had different levels of impact over time, gaining new attention when browsers started shipping high precision timers like performance.now().
To obtain timing measurements attackers must use a clock, either an implicit or explicit one. These clocks are usually interchangeable for the purposes of XS-Leaks and only vary in accuracy and availability. For simplicity, this article will assume use of the performance."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Network Timing"><meta property="og:description" content="Network Timing side-channels have been present on the web since its beginning 1 2. These attacks have had different levels of impact over time, gaining new attention when browsers started shipping high precision timers like performance.now().
To obtain timing measurements attackers must use a clock, either an implicit or explicit one. These clocks are usually interchangeable for the purposes of XS-Leaks and only vary in accuracy and availability. For simplicity, this article will assume use of the performance."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/attacks/timing-attacks/network-timing/"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-14T14:05:24-07:00"><title>Network Timing | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.092646ee0a13bc3d434088e3ef209623b91ad8714e3f5b61c7d3d1a096669ae7.css integrity="sha256-CSZG7goTvD1DQIjj7yCWI7ka2HFOP1thx9PRoJZmmuc="><script defer src=/en.search.min.1cb2c6fa03450539833df3ef7c98c2ab9ad829929ad28c277d018f26d9127765.js integrity="sha256-HLLG+gNFBTmDPfPvfJjCq5rYKZKa0ownfQGPJtkSd2U="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/ class=active>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Network Timing</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#modern-web-timing-attacks>Modern Web Timing Attacks</a></li><li><a href=#frame-timing-attacks-network>Frame Timing Attacks (Network)</a></li><li><a href=#sandboxed-frame-timing-attacks>Sandboxed Frame Timing Attacks</a></li><li><a href=#cross-window-timing-attacks>Cross-window Timing Attacks</a></li><li><a href=#timeless-timing-attacks>Timeless Timing Attacks</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>Network Timing</h1><h5>October 1, 2020</h5><div>Abuse
<a href=/abuse/iframes/>iframes</a></div><div>Category
<a href=/category/attack/>Attack</a></div><div>Defenses
<a href=/defenses/fetch-metadata/>Fetch Metadata</a>,
<a href=/defenses/samesite-cookies/>SameSite Cookies</a>,
<a href=/defenses/coop/>COOP</a>,
<a href=/defenses/framing-protections/>Framing Protections</a></div><p><p>Network Timing side-channels have been present on the web since its beginning <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. These attacks have had different levels of impact over time, gaining new attention when browsers started shipping high precision timers like <a href=https://xsleaks.com/docs/attacks/timing-attacks/clocks/#performancenow>performance.now()</a>.</p><p>To obtain timing measurements attackers must use a <a href=https://xsleaks.com/docs/attacks/timing-attacks/clocks/>clock</a>, either an implicit or explicit one. These clocks are usually interchangeable for the purposes of XS-Leaks and only vary in accuracy and availability. For simplicity, this article will assume use of the <code>performance.now()</code> API, an explicit clock present in all modern browsers.</p><p>This side-channel allows attackers to infer information from a cross-site request based on how much time it takes to complete that request <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. The network timing measurement may vary based on a user state and it&rsquo;s usually connected to:</p><ul><li>The resource size.</li><li>The computation time in the backend.</li><li>The number and size of sub-resources.</li><li><a href=https://xsleaks.com/docs/attacks/cache-probing/>Cache status</a>.</li></ul><blockquote class="book-hint good">Learn more about the different types of clocks in the <a href=https://xsleaks.com/docs/attacks/timing-attacks/clocks/>Clocks Article</a>.</blockquote><h2 id=modern-web-timing-attacks>Modern Web Timing Attacks
<a class=anchor href=#modern-web-timing-attacks>#</a></h2><p>The <a href=https://xsleaks.com/docs/attacks/timing-attacks/clocks/#performancenow>performance.now()</a> API can be used to measure how much time it takes to perform a request.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>before</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>()
<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;https://target-website.com&#39;</span>,{<span style=color:#e6db74>&#39;mode&#39;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;no-cors&#39;</span>,<span style=color:#e6db74>&#39;credentials&#39;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#39;include&#39;</span>})
<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>request_time</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>before</span>
</code></pre></div><h2 id=frame-timing-attacks-network>Frame Timing Attacks (Network)
<a class=anchor href=#frame-timing-attacks-network>#</a></h2><p>If the target page enforces <a href=https://xsleaks.com/docs/defenses/opt-in/xfo/>Framing Protections</a>, embedding it as an <code>iframe</code> allows an attacker to obtain a network timing measurement. The example below shows how to achieve this by starting a <a href=https://xsleaks.com/docs/attacks/timing-attacks/clocks/>clock</a>, embedding the page as an <code>iframe</code> (request is started), and wait for the <code>onload</code> event to be triggered which means the request completed. In this scenario when the request completes the browser does not render the fetched resource because of the protection.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>begin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>();
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;iframe&#39;</span>);
<span style=color:#a6e22e>x</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://target.page&#34;</span>;
document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>x</span>);
<span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>();
<span style=color:#a6e22e>x</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> () =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>begin</span>)
</code></pre></div><h2 id=sandboxed-frame-timing-attacks>Sandboxed Frame Timing Attacks
<a class=anchor href=#sandboxed-frame-timing-attacks>#</a></h2><p>When a page sets <a href=https://xsleaks.com/docs/defenses/opt-in/xfo/>Framing Protections</a>, an attacker can obtain an almost pure network measurement by including the <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe><code>sandbox</code></a> attribute in the <code>iframe</code>. This attribute will block all JavaScript execution and prevent some subresources from loading.</p><h2 id=cross-window-timing-attacks>Cross-window Timing Attacks
<a class=anchor href=#cross-window-timing-attacks>#</a></h2><p>An attacker can also measure the network timing of a page by opening a new window with <code>window.open</code> and waiting for the <code>window</code> to start loading. The snippet below shows how to make this measurement and works as follows:</p><ol><li>The attacker creates an infinite loop of <code>postMessage</code> broadcasts to itself while opening a window to the target website (lines 15, 2, 7). The clock is started (line 14).</li><li>When the window is created, its location <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/open>will be <code>about:blank</code></a> until the target page starts loading.</li><li>In the infinite loop, the logic clause (line 4) will be <code>true</code> while the opened window remains in <code>about:blank</code> as its document it&rsquo;s still accessible from the attacker&rsquo;s origin.</li><li>When the window starts loading, the location will change from <code>about:blank</code> to the target&rsquo;s origin.</li><li>The attacker&rsquo;s origin won&rsquo;t have access to the document of the opened window as per Same-Origin Policy. When this occurs, the logic clause (line 4) will fail and throw a <code>DOMException</code>.</li><li>The attacker catches the Exception and stops the clock.</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>w</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>begin</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
<span style=color:#a6e22e>onmessage</span><span style=color:#f92672>=</span>()=&gt;{
  <span style=color:#66d9ef>try</span>{
    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>w</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>w</span>.document.<span style=color:#a6e22e>cookie</span>){
      <span style=color:#75715e>// still same origin
</span><span style=color:#75715e></span>    }
    <span style=color:#a6e22e>postMessage</span>(<span style=color:#e6db74>&#39;&#39;</span>,<span style=color:#e6db74>&#39;*&#39;</span>);
  }<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>e</span>){
    <span style=color:#a6e22e>end</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>();
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;time to load was&#39;</span>, <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>begin</span>);
  }
};
<span style=color:#a6e22e>postMessage</span>(<span style=color:#e6db74>&#39;&#39;</span>,<span style=color:#e6db74>&#39;*&#39;</span>);
<span style=color:#a6e22e>begin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>performance</span>.<span style=color:#a6e22e>now</span>();
<span style=color:#a6e22e>w</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#39;//mail.com/search?q=foo&#39;</span>);
</code></pre></td></tr></table></div></div><blockquote class="book-hint good">This technique can also be adapted to measure the Execution Timing of a page by <a href=https://xsleaks.com/docs/attacks/timing-attacks/execution-timing/#busy-event-loop>making the event loop busy</a>.</blockquote><h2 id=timeless-timing-attacks>Timeless Timing Attacks
<a class=anchor href=#timeless-timing-attacks>#</a></h2><p>Other attacks do not consider the notion of time to perform a timing attack <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. Timeless attacks consist of fitting two <code>HTTP</code> requests in a single packet, the baseline and the attacked request, to guarantee they arrive at the same time to the server. The server <em>will</em> process the requests concurrently, and return a response based on their execution time as soon as possible. One of the two requests will arrive first, allowing the attacker to get the timing difference by comparing the order in which the requests arrived.</p><p>The advantage of this technique is the independence on network jitter and uncertain delays, something that is always present in the remaining techniques.</p><blockquote class="book-hint warning">The original research needs to be adapted to work in a browser since it handles all network-specific tasks.</blockquote><blockquote class="book-hint warning">This attack is limited to specific versions of HTTP and joint scenarios. It makes certain assumptions and has requirements regarding server behaviors.</blockquote><h2 id=defense>Defense
<a class=anchor href=#defense>#</a></h2><table><thead><tr><th style=text-align:center>Attack Alternative</th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/coop/>COOP</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/xfo/>Framing Protections</a></th></tr></thead><tbody><tr><td style=text-align:center>Modern Timing Attacks</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td style=text-align:center>Frame Timing (Network)</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>Frame Timing (Sandbox)</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>-</td></tr><tr><td style=text-align:center>Cross-window Timing</td><td style=text-align:center>✔️ <a href=https://xsleaks.com/docs/defenses/opt-in/same-site-cookies/#lax-vs-strict>(if Strict)</a></td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td style=text-align:center>Timeless Timing</td><td style=text-align:center>✔️</td><td style=text-align:center>❓</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr></tbody></table><h2 id=references>References
<a class=anchor href=#references>#</a></h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Exposing Private Information by Timing Web Applications, <a href=https://crypto.stanford.edu/~dabo/papers/webtiming.pdf>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Cross-domain search timing, <a href=https://scarybeastsecurity.blogspot.com/2009/12/cross-domain-search-timing.html>link</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>The Clock is Still Ticking: Timing Attacks in the Modern Web - Section 4.3.3, <a href=https://tom.vg/papers/timing-attacks_ccs2015.pdf>link</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>Timeless Timing Attacks: Exploiting Concurrency to Leak Secrets over Remote Connections, <a href=https://www.usenix.org/system/files/sec20-van_goethem.pdf>link</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/9b963202107fa3bd5834d14f2e61a085192ae77f title="Last modified by David Dworken | October 14, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: October 14, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/timing-attacks/network-timing.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#modern-web-timing-attacks>Modern Web Timing Attacks</a></li><li><a href=#frame-timing-attacks-network>Frame Timing Attacks (Network)</a></li><li><a href=#sandboxed-frame-timing-attacks>Sandboxed Frame Timing Attacks</a></li><li><a href=#cross-window-timing-attacks>Cross-window Timing Attacks</a></li><li><a href=#timeless-timing-attacks>Timeless Timing Attacks</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>