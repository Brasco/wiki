<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Cross-Origin Read Blocking (CORB) is a web platform security feature aimed at reducing the impact of speculative side-channel attacks such as Spectre. Unfortunately, blocking certain types of requests introduced a new type of XS-Leaks that allows attackers to detect if CORB was enforced on one request, but wasn&rsquo;t on another. Nevertheless, the introduced XS-Leaks are much less problematic than the issues actively protected by CORB (e.g Spectre).
 info
This issue is known to Chromium, and while it might remain unfixed, its impact is highly reduced by the rollout of Same-Site Cookies by default in Chromium-based browsers."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="CORB Leaks"><meta property="og:description" content="Cross-Origin Read Blocking (CORB) is a web platform security feature aimed at reducing the impact of speculative side-channel attacks such as Spectre. Unfortunately, blocking certain types of requests introduced a new type of XS-Leaks that allows attackers to detect if CORB was enforced on one request, but wasn&rsquo;t on another. Nevertheless, the introduced XS-Leaks are much less problematic than the issues actively protected by CORB (e.g Spectre).
 info
This issue is known to Chromium, and while it might remain unfixed, its impact is highly reduced by the rollout of Same-Site Cookies by default in Chromium-based browsers."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.dev/docs/attacks/browser-features/corb/"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-11T17:18:06+01:00"><title>CORB Leaks | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.62d4a8cadd84fac6902eda1a0d09fc02098feb2b5faa4fd18c9862eb3c0b03a4.css integrity="sha256-YtSoyt2E+saQLtoaDQn8AgmP6ytfqk/RjJhi6zwLA6Q="><script defer src=/en.search.min.bd9b8e6dce18beeef1ce8bf16896827fb872f7e0fdc0fe4eaf8578722bf22a7e.js integrity="sha256-vZuObc4Yvu7xzovxaJaCf7hy9+D9wP5Or4V4civyKn4="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/ class=active>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>CORB Leaks</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#corb--error-events>CORB & Error Events</a></li><li><a href=#detect-nosniff-header>Detect <code>nosniff</code> Header</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>CORB Leaks</h1><h5>October 1, 2020</h5><div>Abuse
<a href=/abuse/browser-feature/>Browser Feature</a>,
<a href=/abuse/error-events/>Error Events</a>,
<a href=/abuse/content-type/>Content-Type</a>,
<a href=/abuse/nosniff/>nosniff</a></div><div>Category
<a href=/category/attack/>Attack</a></div><div>Defenses
<a href=/defenses/fetch-metadata/>Fetch Metadata</a>,
<a href=/defenses/samesite-cookies/>SameSite Cookies</a></div><p><p><a href=https://xsleaks.dev/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a> (CORB) is a web platform security feature aimed at reducing the impact of speculative side-channel attacks such as Spectre. Unfortunately, blocking certain types of requests introduced a new type of XS-Leaks that allows attackers to detect if CORB was enforced on one request, but wasn&rsquo;t on another. Nevertheless, the introduced XS-Leaks are much less problematic than the issues actively protected by CORB (e.g Spectre).</p><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p>This issue is known to Chromium, and while it <a href="https://docs.google.com/document/d/1kdqstoT1uH5JafGmRXrtKE4yVfjUVmXitjcvJ4tbBvM/edit?ts=5f2c8004">might remain unfixed</a>, its impact is highly reduced by the <a href=https://blog.chromium.org/2020/05/resuming-samesite-cookie-changes-in-july.html>rollout of Same-Site Cookies by default</a> in Chromium-based browsers.</blockquote><h2 id=corb--error-events>CORB & Error Events
<a class=anchor href=#corb--error-events>#</a></h2><p>Attackers can observe when CORB is enforced if a response returns a <em>CORB protected</em> <code>Content-Type</code> (and <code>nosniff</code>) with status code <code>2xx</code> which results in CORB stripping the body and headers from the response. Detecting this protection will allow an attacker to leak the combination of both the status code (success vs. error) and the <code>Content-Type</code> (protected by CORB or not). This allows the distinction of two possible states:</p><ul><li>One state results in a request being protected by CORB and the second a client error (404).</li><li>One state is protected by CORB and the second is not.</li></ul><p>The following steps could be observed to abuse this protection with the first example:</p><ol><li>An attacker can embed a cross-origin resource in a <code>script</code> tag which returns <code>200 OK</code> with <code>text/html</code> as <code>Content-Type</code> and a <code>nosniff</code> Header.</li><li>To protect sensitive contents from entering the attacker&rsquo;s process, <code>CORB</code> will replace the original response with an empty one.</li><li>Since an empty response is valid JavaScript, the <code>onerror</code> event won&rsquo;t be fired and <code>onload</code> will fire instead.</li><li>The attacker triggers a second request (corresponding to a second state), similar to 1., which returns something other than <code>200 OK</code>. The <code>onerror</code> event will fire.</li></ol><p>The interesting behavior is that CORB creates a valid resource out of request which could contain something other than JavaScript (causing an error). Considering a non-CORB environment, both 1. and 4. requests would trigger an error. This introduces an XS-Leak as these situations are now distinguishable.</p><h2 id=detect-nosniff-header>Detect <code>nosniff</code> Header
<a class=anchor href=#detect-nosniff-header>#</a></h2><p>CORB could also allow attackers to detect when the <code>nosniff</code> header is present in the request. This problem originated due to the fact CORB is only enforced depending on the presence of this header and some sniffing algorithms. The example below shows two distinguishable states:</p><ol><li>CORB will prevent an attacker page which embeds a resource as a <code>script</code> if the resource is served with <code>text/html</code> as <code>Content-Type</code> along with the <code>nosniff</code> header.</li><li>If the resource does not set <code>nosniff</code> and CORB <a href=https://chromium.googlesource.com/chromium/src/+/master/services/network/cross_origin_read_blocking_explainer.md#what-types-of-content-are-protected-by-corb>fails</a> to infer the <code>Content-Type</code> of the page (which remains <code>text/html</code>), a <code>SyntaxError</code> will be fired since the contents can&rsquo;t be parsed as valid JavaScript. This error can be caught by listening to <code>window.onerror</code> as <code>script</code> tags only trigger error events in <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLScriptElement>certain conditions</a>.</li></ol><h2 id=defense>Defense
<a class=anchor href=#defense>#</a></h2><table><thead><tr><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/coop/>COOP</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/xfo/>Framing Protections</a></th></tr></thead><tbody><tr><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr></tbody></table><blockquote class="book-hint2 tip"><p class="hint-title tip"><svg class="book-icon"><use href="/svg/hint-icons.svg#tip-notice"/></svg><span>tip</span></p>Developers can deploy <a href=https://xsleaks.dev/docs/defenses/opt-in/corp/>CORP</a> in application&rsquo;s subresources to force a protection similar to CORB that does not inspect responses to decide when to act. To prevent attackers from abusing this XS-Leak, generic XS-Leaks defense mechanisms are also effective.</blockquote><h2 id=references>References
<a class=anchor href=#references>#</a></h2></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/7f52379202f21cdd3063874f4c9f433f11cac9f2 title="Last modified by terjanq | November 11, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: November 11, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/browser-features/corb.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#corb--error-events>CORB & Error Events</a></li><li><a href=#detect-nosniff-header>Detect <code>nosniff</code> Header</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>