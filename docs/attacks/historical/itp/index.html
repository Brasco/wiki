<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Intelligent Tracking Prevention (ITP) is a privacy feature part of WebKit Tracking Prevention technologies. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context. Unfortunately, the initial design introduced a new XS-Leak 1, allowing attackers to abuse the states implicitly created by ITP to classify websites as trackers.
Root Cause #  To classify whether a website had tracking capabilities, ITP collects statistics on resource loads as well as user interactions in websites such as clicks, taps, or text entries."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="WebKit - ITP"><meta property="og:description" content="Intelligent Tracking Prevention (ITP) is a privacy feature part of WebKit Tracking Prevention technologies. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context. Unfortunately, the initial design introduced a new XS-Leak 1, allowing attackers to abuse the states implicitly created by ITP to classify websites as trackers.
Root Cause #  To classify whether a website had tracking capabilities, ITP collects statistics on resource loads as well as user interactions in websites such as clicks, taps, or text entries."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/attacks/historical/itp/"><meta property="article:published_time" content="2020-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-24T14:32:10+01:00"><title>WebKit - ITP | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.3fdda1dce1e2459a1b1fc70c3e00001cd6e4d2f1f32f38ddef6e12ca41e9cef6.css integrity="sha256-P92h3OHiRZobH8cMPgAAHNbk0vHzLzjd724SykHpzvY="><script defer src=/en.search.min.55bbe51b7c566d76276792047f4ea0e56d93dbbc0aefdca33c3791dc096ab941.js integrity="sha256-VbvlG3xWbXYnZ5IEf06g5W2T27wK79yjPDeR3AlquUE="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/docs/attacks/>Attacks</a><ul><li><a href=/docs/attacks/experiments/>Experiments</a><ul><li><a href=/docs/attacks/experiments/scroll-to-text-fragment/>Scroll to Text Fragment</a></li></ul></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a><ul><li><a href=/docs/attacks/historical/content-type/>typeMustMatch</a></li><li><a href=/docs/attacks/historical/itp/ class=active>WebKit - ITP</a></li></ul></li><li><a href=/docs/attacks/timing-attacks/>Timing Attacks</a><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li></ul></li><li><a href=/docs/attacks/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/corp/>CORP Leaks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><span>Application Design</span><ul><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><span>Browser Default</span><ul><li><a href=/docs/defenses/browser-intrinsic/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/browser-intrinsic/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li><li><span>Opt-In</span><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>WebKit - ITP</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#root-cause>Root Cause</a><ul><li><a href=#issues>Issues</a></li></ul></li><li><a href=#fix>Fix</a></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>WebKit - ITP</h1><h5>July 21, 2020</h5><div>Attacks
<a href=/attacks/dom-property/>dom property</a></div><div>Category
<a href=/category/historical/>historical</a></div><div>Defenses
<a href=/defenses/todo/>TODO</a></div><p><p><a href=https://webkit.org/tracking-prevention/>Intelligent Tracking Prevention</a> (ITP) is a privacy feature part of WebKit Tracking Prevention technologies. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context. Unfortunately, the initial design introduced a new XS-Leak <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, allowing attackers to abuse the states implicitly created by ITP to classify websites as trackers.</p><h2 id=root-cause>Root Cause
<a class=anchor href=#root-cause>#</a></h2><p>To classify whether a website had tracking capabilities, ITP collects statistics on resource loads as well as user interactions in websites such as clicks, taps, or text entries. Based on the classification of these statistics, ITP gives a strike to a website if it is believed to have tracking capabilities. After 3 strikes a website is put on a deny list and have a different treatment by the browser in certain requests.</p><h3 id=issues>Issues
<a class=anchor href=#issues>#</a></h3><p>One of the issues of ITP is that attackers can interact with it to arbitrarily enforce certain behaviors. For example, one could force ITP to give a strike to a domain and check if the domain entered the deny list. Some of the attacks leveraging ITP consist in:</p><ul><li>Checking if a website enters the deny list, or how many strikes left are needed to put a website on the deny list may allow an attacker to discover user&rsquo;s browsing habits.</li><li>An attacker could attack a Search System with <a href=https://TODO>XS-Search</a> if it includes any <strong>cross-site resource</strong> when results are present, but omits that same resource when no results are found. Attackers could force ITP to give 2 strikes to the <strong>cross-site resource</strong> and, after triggering a request to the search system, check if the resource was put in the deny list.</li></ul><h2 id=fix>Fix
<a class=anchor href=#fix>#</a></h2><p>To <a href=https://webkit.org/blog/9661/preventing-tracking-prevention-tracking/>fix the issue</a>, instead of relying on classifications, ITP now considers every site as a &ldquo;tracking&rdquo; one by default. This removes the implicit states which allowed attackers to detect certain ITP behaviors.</p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Information Leaks via Safari’s Intelligent Tracking Prevention, <a href=https://arxiv.org/pdf/2001.07421.pdf>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/3da9b9685442b8372babe7220275c41ea2c5d9c6 title="Last modified by Manuel Sousa | September 24, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: September 24, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/historical/itp.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#root-cause>Root Cause</a><ul><li><a href=#issues>Issues</a></li></ul></li><li><a href=#fix>Fix</a></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>